<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Play — Aryan Guddy New App (installable)</title>
<link rel="manifest" id="manifest-link">
<meta name="theme-color" content="#1a73e8">
<style>
  :root{--bg:#f4f6f8;--card:#fff;--accent:#1a73e8;--dark:#111827;--muted:#6b7280;--radius:12px}
  *{box-sizing:border-box} body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:var(--dark)}
  .top{display:flex;align-items:center;gap:12px;padding:12px 16px;background:#fff;border-bottom:1px solid #eef2f7}
  .wrap{max-width:980px;margin:18px auto;padding:0 16px}
  .store{display:grid;grid-template-columns:360px 1fr;gap:20px}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 8px 24px rgba(16,24,40,.06)}
  .icon{width:96px;height:96px;border-radius:18px;overflow:hidden;border:1px solid rgba(0,0,0,.04)}
  .icon img{width:100%;height:100%;object-fit:cover}
  h1{margin:0 0 6px;font-size:18px}
  .meta{color:var(--muted);font-size:13px}
  .btn{padding:10px 14px;border-radius:12px;border:0;cursor:pointer;font-weight:700}
  .btn-primary{background:var(--accent);color:#fff}
  .btn-ghost{background:#fff;border:1px solid #e6eefc;color:var(--dark)}
  .screens{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:14px}
  .screen{height:150px;border-radius:10px;overflow:hidden;background:#f3f6f9}
  .screen img{width:100%;height:100%;object-fit:cover}
  footer{text-align:center;color:var(--muted);margin:24px 0}
  /* Pacman overlay */
  #pacmanScreen{display:none;position:fixed;inset:0;background:linear-gradient(#000,#041023);z-index:9999;align-items:center;justify-content:center;flex-direction:column}
  #pacCanvas{border-radius:12px;box-shadow:0 12px 40px rgba(2,6,23,.6)}
  .topbarFixed{position:fixed;top:12px;left:12px;right:12px;display:flex;justify-content:space-between;align-items:center;color:#fff;z-index:10000}
  .pac-btn{background:rgba(255,255,255,0.06);color:#fff;border:1px solid rgba(255,255,255,0.08);padding:8px 12px;border-radius:10px;cursor:pointer;margin-left:8px}
  @media(max-width:900px){.store{grid-template-columns:1fr} .screens{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>

<div class="top"><strong>Play</strong><div style="flex:1"></div></div>

<div class="wrap">
  <div class="store">
    <aside class="card" aria-label="app card">
      <div style="display:flex;gap:12px;align-items:center">
        <div class="icon" id="appIconWrap">
          <!-- icon shown in UI; still can be different from manifest icon -->
          <img id="uiIcon" src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect rx='80' width='100%' height='100%' fill='%23ff6b6b'/><text x='50%' y='56%' font-size='200' font-family='Arial' fill='white' text-anchor='middle' alignment-baseline='middle'>G</text></svg>">
        </div>
        <div style="flex:1">
          <h1>Aryan Guddy New App</h1>
          <div class="meta">Editors' Choice • Social • 10M+ installs</div>
          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="installBtn" class="btn btn-primary" style="display:none">Install</button>
            <button id="openBtn" class="btn btn-ghost" style="display:none">Open</button>
            <button id="playBtn" class="btn btn-ghost">Play Pac-Man</button>
            <button id="downloadBtn" class="btn btn-ghost">Download .html</button>
          </div>
        </div>
      </div>

      <div class="screens" style="margin-top:16px" id="screens">
        <!-- Replace these <img> srcs with data URIs if you want fully-embedded images -->
        <div class="screen"><img id="ss1" src="https://i.pinimg.com/736x/96/79/1f/96791fb42598a62e576a90fd00f8813e.jpg" alt="s1"></div>
        <div class="screen"><img id="ss2" src="https://i.pinimg.com/1200x/90/85/23/908523ce3a1c3bca41e121ad53fcf265.jpg" alt="s2"></div>
        <div class="screen"><img id="ss3" src="https://i.pinimg.com/1200x/a0/8f/5f/a08f5f3358eb09e252b888db5bfb91ce.jpg" alt="s3"></div>
      </div>

      <p style="color:#6b7280;font-size:13px;margin-top:12px">Open this page in Chrome on Android over HTTPS or localhost to allow installation. If install doesn't appear, either host the images on the same origin or replace icons with base64 data URIs (see notes below).</p>
    </aside>

    <main>
      <div class="card">
        <h3 style="margin:0 0 8px 0">About this app</h3>
        <p style="color:#6b7280;margin:0">Demo PWA that installs to your home screen and includes a small Pac-Man mini-game. The manifest and service worker are included in this single file.</p>
      </div>

      <div class="card" style="margin-top:14px">
        <h3 style="margin:0 0 8px 0">Install diagnostics</h3>
        <ul style="color:#6b7280;margin:0 0 0 18px;">
          <li>Manifest: generated in-memory and attached.</li>
          <li>Service Worker: registered from script (console logs appear if registration fails).</li>
          <li>Icon: currently set to an inline SVG icon for guaranteed installability.</li>
          <li>To use external Pinterest images as install icons: host them on the same HTTPS origin or paste base64 data URIs into the manifest `icons` block (see code comments).</li>
        </ul>
      </div>
    </main>
  </div>
</div>

<!-- Pac-Man overlay -->
<div id="pacmanScreen" aria-hidden="true" style="display:none;align-items:center;justify-content:center;flex-direction:column;position:fixed;inset:0;z-index:9999">
  <div class="topbarFixed">
    <div id="score" style="color:#fff;font-weight:700">Score: 0</div>
    <div>
      <button id="restart" class="pac-btn">Restart</button>
      <button id="closePac" class="pac-btn">Close</button>
    </div>
  </div>
  <canvas id="pacCanvas" width="480" height="480" style="max-width:90vw;max-height:70vh;border-radius:12px;background:#000"></canvas>
  <div id="pacNote" style="color:#cbd5e1;margin-top:12px">Use arrow keys or swipe</div>
</div>

<footer>Demo single-file PWA — save & test over HTTPS or localhost</footer>

<script>
/*
  Important notes:
  - If you want the *exact* Pinterest images to be used as the install icon,
    either: (A) host those image files on the same HTTPS origin and set their
    URLs in the manifest below (recommended), or (B) convert the images to
    base64 data URIs and paste into the manifest icons array (works offline).
  - Chrome requires a valid manifest + reachable icon + a registered service worker.
*/

/* ---------- helper: log with prefix ---------- */
function log(...a){ console.log('[PWA-DEMO]', ...a); }

/* ---------- create manifest (inline icon to guarantee installability) ---------- */
/* If you want to use remote images as manifest icons, replace the inlineIcon variable
   with their HTTPS URL (same-origin recommended), or with a data:image/... base64 URI.
*/
const inlineIconSVG = `<svg xmlns='http://www.w3.org/2000/svg' width='512' height='512'><rect rx='80' width='100%' height='100%' fill='%23ff6b6b'/><text x='50%' y='56%' font-size='200' font-family='Arial' fill='white' text-anchor='middle' alignment-baseline='middle'>G</text></svg>`;
const inlineIconData = "data:image/svg+xml;utf8," + encodeURIComponent(inlineIconSVG);

/* If you want to use your supplied Pinterest image as manifest icon,
   replace icon.src below with the direct HTTPS URL hosted on your domain,
   OR replace with a data URI (very long). */

/* manifest object */
const manifest = {
  name: "Aryan Guddy New App",
  short_name: "GuddyApp",
  start_url: "./?homescreen=1",
  scope: "./",
  display: "standalone",
  background_color: "#ffffff",
  theme_color: "#1a73e8",
  icons: [
    /* guaranteed-working inline SVG icon */
    { src: inlineIconData, sizes: "192x192", type: "image/svg+xml", purpose: "any maskable" }

    /* ----- Example: to use a hosted Pinterest image (recommended hosting method):
    , { src: "https://yourdomain.com/path/af2217...jpg", sizes:"192x192", type:"image/jpeg", purpose:"any maskable" }
    ----- */

    /* ----- Example: to use data-uri base64 image (paste your base64 string)
    , { src: "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...", sizes:"512x512", type:"image/jpeg", purpose:"any maskable" }
    ----- */
  ]
};

/* Attach generated manifest */
const manifestBlob = new Blob([JSON.stringify(manifest)], {type: 'application/json'});
const manifestURL = URL.createObjectURL(manifestBlob);
document.getElementById('manifest-link').href = manifestURL;

/* Update the small UI icon to match manifest icon for consistent appearance */
document.getElementById('uiIcon').src = inlineIconData;

/* ---------- Service worker (simple, with logs) ---------- */
const swSource = `
self.addEventListener('install', evt => {
  self.skipWaiting();
  console.log('[SW] install');
  evt.waitUntil(caches.open('pwa-cache-v1').then(c => c.addAll(['./','./?homescreen=1'])));
});
self.addEventListener('activate', evt => { console.log('[SW] activate'); evt.waitUntil(self.clients.claim()); });
self.addEventListener('fetch', evt => {
  if (evt.request.method !== 'GET') return;
  evt.respondWith(caches.match(evt.request).then(r => r || fetch(evt.request).then(res => { caches.open('pwa-cache-v1').then(c => c.put(evt.request, res.clone())); return res; } )).catch(()=>caches.match('./')));
});
`;
const swBlob = new Blob([swSource], {type: 'application/javascript'});

/* Register SW and report any errors to console */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register(URL.createObjectURL(swBlob)).then(reg => {
    log('serviceWorker registered', reg);
  }).catch(err => {
    log('serviceWorker registration failed', err);
  });
} else {
  log('serviceWorker not supported in this browser');
}

/* ---------- PWA install handling ---------- */
let deferredPrompt = null;
const installBtn = document.getElementById('installBtn');
const openBtn = document.getElementById('openBtn');

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = 'inline-block';
  log('beforeinstallprompt fired — app install eligible');
});

window.addEventListener('appinstalled', () => {
  log('appinstalled event');
  installBtn.textContent = 'Installed';
  installBtn.disabled = true;
  deferredPrompt = null;
});

/* fallback: if the page is running as standalone (installed), show Open */
if (window.matchMedia('(display-mode: standalone)').matches || navigator.standalone === true || location.search.includes('homescreen=1')) {
  installBtn.style.display = 'none';
  openBtn.style.display = 'inline-block';
}

/* click install */
installBtn.addEventListener('click', async () => {
  if (!deferredPrompt) {
    alert('Install prompt not available. Use browser menu -> Add to Home screen.');
    return;
  }
  deferredPrompt.prompt();
  const choice = await deferredPrompt.userChoice;
  log('userChoice', choice);
  if (choice.outcome === 'accepted') {
    installBtn.textContent = 'Installed';
    installBtn.disabled = true;
  }
  deferredPrompt = null;
});

openBtn.addEventListener('click', () => location.href = './?homescreen=1');

/* ---------- Download button ---------- */
document.getElementById('downloadBtn').addEventListener('click', () => {
  const html = '<!doctype html>\\n' + document.documentElement.outerHTML;
  const blob = new Blob([html], {type: 'text/html'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'aryan-guddy-pwa.html';
  a.click();
});

/* ---------- Pac-Man minimal (same as earlier) ---------- */
const pacScreen = document.getElementById('pacmanScreen');
const canvas = document.getElementById('pacCanvas');
const ctx = canvas.getContext('2d');
const scoreEl = document.getElementById('score');
const closePac = document.getElementById('closePac');
const restart = document.getElementById('restart');

const TILE = 24, COLS = 20, ROWS = 20;
canvas.width = COLS*TILE;
canvas.height = ROWS*TILE;

let map, player, ghosts, score, pelletsLeft, tickId, inputDir;

function newGame(){ /* create map, player, ghosts, pellets */ 
  map = []; for(let r=0;r<ROWS;r++){ const row=[]; for(let c=0;c<COLS;c++){ if(r===0||c===0||r===ROWS-1||c===COLS-1) row.push(1); else if((r%2===0 && c%2===0) && !(r>7 && r<12 && c>7 && c<12)) row.push(1); else row.push(2); } map.push(row); }
  for(let r=8;r<=11;r++) for(let c=8;c<=11;c++) map[r][c]=0;
  player={x:1,y:1,dir:{x:0,y:0}}; ghosts=[{x:COLS-2,y:1,color:'#ff3b30'},{x:1,y:ROWS-2,color:'#00d4ff'},{x:COLS-2,y:ROWS-2,color:'#ffb84d'}];
  score=0; pelletsLeft=0; for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++) if(map[r][c]===2) pelletsLeft++;
  inputDir=null; updateScore();
  if(tickId) clearInterval(tickId); tickId = setInterval(gameTick, 110);
}
function draw(){ ctx.clearRect(0,0,canvas.width,canvas.height); for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){ const v=map[r][c], x=c*TILE, y=r*TILE; if(v===1){ ctx.fillStyle='#14324e'; ctx.fillRect(x,y,TILE,TILE); } else if(v===2){ ctx.fillStyle='#ffd54f'; ctx.beginPath(); ctx.arc(x+TILE/2,y+TILE/2,TILE*0.08,0,Math.PI*2); ctx.fill(); } } const pacX=player.x*TILE+TILE/2, pacY=player.y*TILE+TILE/2; ctx.fillStyle='#ffd700'; const open=Math.abs(Math.sin(Date.now()/120))*0.28+0.12; let angle=0; if(player.dir.x===1) angle=0; else if(player.dir.x===-1) angle=Math.PI; else if(player.dir.y===1) angle=Math.PI/2; else if(player.dir.y===-1) angle=-Math.PI/2; ctx.beginPath(); ctx.moveTo(pacX,pacY); ctx.arc(pacX,pacY,TILE*0.45,angle+open*Math.PI,angle-open*Math.PI); ctx.closePath(); ctx.fill(); ghosts.forEach(g=>{ const gx=g.x*TILE+TILE/2, gy=g.y*TILE+TILE/2; ctx.fillStyle=g.color; ctx.beginPath(); ctx.arc(gx,gy,TILE*0.42,Math.PI,0); ctx.fill(); ctx.fillRect(gx-TILE*0.42,gy,TILE*0.84,TILE*0.42); ctx.fillStyle='#fff'; ctx.beginPath(); ctx.arc(gx-TILE*0.12,gy-TILE*0.05,TILE*0.12,0,Math.PI*2); ctx.arc(gx+TILE*0.18,gy-TILE*0.05,TILE*0.12,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#000'; ctx.beginPath(); ctx.arc(gx-TILE*0.12,gy-TILE*0.05,TILE*0.05,0,Math.PI*2); ctx.arc(gx+TILE*0.18,gy-TILE*0.05,TILE*0.05,0,Math.PI*2); ctx.fill(); }); }
function canMove(x,y){ if(x<0||y<0||x>=COLS||y>=ROWS) return false; return map[y][x]!==1; }
function tryMove(o,d){ const nx=o.x+d.x, ny=o.y+d.y; if(canMove(nx,ny)){ o.x=nx; o.y=ny; o.dir=d; return true; } return false; }
function gameTick(){ if(inputDir) tryMove(player,inputDir); else if(player.dir.x||player.dir.y) tryMove(player,player.dir); if(map[player.y] && map[player.y][player.x]===2){ map[player.y][player.x]=0; score+=10; pelletsLeft--; updateScore(); if(pelletsLeft<=0){ clearInterval(tickId); setTimeout(()=>alert('You win! Score: '+score),100); } } ghosts.forEach(g=>{ const opts=[]; [[1,0],[-1,0],[0,1],[0,-1]].forEach(d=>{ if(canMove(g.x+d[0], g.y+d[1])) opts.push({x:d[0],y:d[1]}); }); if(opts.length){ let chosen = opts[Math.floor(Math.random()*opts.length)]; if(Math.random()<0.36){ opts.sort((a,b)=> (Math.hypot((g.x+a.x)-player.x,(g.y+a.y)-player.y)-Math.hypot((g.x+b.x)-player.x,(g.y+b.y)-player.y))); chosen = opts[0]; } tryMove(g,chosen); } if(g.x===player.x && g.y===player.y){ clearInterval(tickId); setTimeout(()=>alert('Game Over. Score: '+score),100); } }); draw(); }
function updateScore(){ scoreEl = document.getElementById('score'); scoreEl.textContent = 'Score: ' + score; }

/* input handlers: keyboard + swipe */
window.addEventListener('keydown', e=>{ if(getComputedStyle(pacScreen).display==='none') return; if(e.key.includes('Arrow')){ e.preventDefault(); const d=e.key.replace('Arrow',''); if(d==='Left') inputDir={x:-1,y:0}; if(d==='Right') inputDir={x:1,y:0}; if(d==='Up') inputDir={x:0,y:-1}; if(d==='Down') inputDir={x:0,y:1}; } });

let ts=null;
canvas.addEventListener('touchstart', e=>{ ts=e.touches[0]; }, {passive:true});
canvas.addEventListener('touchend', e=>{ if(!ts) return; const t=e.changedTouches[0]; const dx=t.clientX-ts.clientX, dy=t.clientY-ts.clientY; if(Math.abs(dx)>Math.abs(dy)){ if(dx>20) inputDir={x:1,y:0}; else if(dx<-20) inputDir={x:-1,y:0}; } else { if(dy>20) inputDir={x:0,y:1}; else if(dy<-20) inputDir={x:0,y:-1}; } ts=null; }, {passive:true});

/* UI bindings */
document.getElementById('playBtn').addEventListener('click', ()=>{ pacScreen.style.display='flex'; pacScreen.setAttribute('aria-hidden','false'); newGame(); draw(); resizeCanvas(); });
document.getElementById('closePac').addEventListener('click', ()=>{ pacScreen.style.display='none'; pacScreen.setAttribute('aria-hidden','true'); if(tickId) clearInterval(tickId); });
document.getElementById('restart').addEventListener('click', ()=>{ newGame(); draw(); });

function resizeCanvas(){ const maxW = Math.min(window.innerWidth - 40, 560); const maxH = Math.min(window.innerHeight - 160, 560); const size = Math.min(maxW, maxH); canvas.style.width = size + 'px'; canvas.style.height = size + 'px'; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

/* quick diagnostics output (use browser console) */
log('Page loaded. manifestURL=', manifestURL);
navigator.serviceWorker.getRegistrations().then(r=>log('current SW regs', r)).catch(e=>log('sw regs error', e));

/* Optional: if you want the exact Pinterest images embedded (works offline),
   convert them to base64 and replace the manifest.icons array above with:
   { src: "data:image/jpeg;base64,/9j/4AAQ...", sizes:"512x512", type:"image/jpeg", purpose:"any maskable" }
   and also set the UI images (<img src="...">) to the same data URIs.
*/
</script>
</body>
</html>
